# Переводчик

HTTP-сервис на Java (Spring) для перевода набора слов на другой язык.

## Запуск
1. Скачать исходники проекта
2. Установить Java (рекомендуемая версия 11)
3. Установить TomCat (рекомендуемая версия 9.0.91)
4. Установить MySQL Server (рекомендуемая версия 9.0.1). [См. ниже](#установка-и-подготовка-бд)
5. Запустить сервер: [см. ниже](#запуск-сервера)
6. Открыть http://localhost:8080/spring_language_translator/translation?from=en&to=ru&text=Hello

#### Установка и подготовка БД:
- Установить https://dev.mysql.com/downloads/mysql/ – MySQL Community Server 9.0.1 – под нужную ОС и архитектуру
- Установить и сохранить root пароль (либо создать нового пользователя с необходимыми правами)
- Создать и наполнить данными таблицы. Для этого нужно выполнить команды (находясь в папке проекта):
- `/usr/local/mysql/bin/mysql -u root -p < ./src/main/resources/db_init.sql`
- `/usr/local/mysql/bin/mysql -u root -p < ./src/main/resources/db_data_load.sql`
- Последняя команда создает в БД записи о движках переводчика - это необходимо для правильной работы приложения.

#### Запуск сервера

_Перед этим необходимо:_
- Установить Tomcat сервер
- Убедиться, что порты 8080 и 8005 не используются (`netstat -an | grep 8080` и `netstat -an | grep 8005` выдают пустоту)
- Прописать переменные окружения:
- `export DATA_SOURCE_USER_NAME=root`
- `export DATA_SOURCE_USER_PASSWORD=<password>`
- `export TRANSLATION_ENGINE_NAME=<Google|Yandex>` - движок переводчика, Google по умолчанию
- `export TRANSLATION_ENGINE_YANDEX_API_KEY=<ApiKey>` - ключ для работы Яндекс переводчика. Не нужен, если используется Google переводчик

_Этапы запуска сервера:_
1. Запускаем сборку проекта: `mvn clean install` (при необходимости надо установить Maven: `brew install maven`)
2. После этого в папке target должен появится файл spring_language_translator.war
3. Копируем этот файл в папку `{TOMCAT_PATH}/webapps`
4. Запускаем скрипт старта сервера: `{TOMCAT_PATH}/bin/catalina.sh run`
5. После этого сервис будет доступен по пути http://localhost:8080/spring_language_translator/translation?from=en&to=ru&text=Hello
6. Чтобы остановить сервис запускаем скрипт `{TOMCAT_PATH}/bin/catalina.sh stop`
7. Если после этого сервер еще не остановлен запускаем команду: `jps | grep Bootstrap | awk '{print $1}' | xargs kill -TERM`

## Взаимодействие с сервисом

Входные данные передаются параметрами GET-запросов, так что для работы с сервисом достаточно браузера (но инструменты вроде Postman могут быть удобнее).

### Перевод слов

Параметры:
- `from` – язык запроса. По умолчанию используется значение `auto`, то есть автоопределение исходного языка.
- `to` – язык ответа, обязательный параметр.
- `text` – текст для перевода, обязательный параметр.

Примеры:
- http://localhost:8080/spring_language_translator/translation?from=en&to=ru&text=Hello
- http://localhost:8080/spring_language_translator/translation?from=ru&to=en&text=Привет%20мир

## Движок перевода слов

В системе предусмотрено два способа переводить слова: через Яндекс переводчик и через Google переводчик.
Выбор движка перевода осуществляется через переменную окружения `TRANSLATION_ENGINE_NAME`: `Yandex` или `Google`.
Для работы Яндекс переводчика необходимо также в переменной окружения `TRANSLATION_ENGINE_YANDEX_API_KEY` указать ключ доступа.
Подробнее см. https://yandex.cloud/ru/docs/translate/operations/sa-api-key#console_1

По умолчанию работает переводчик Google.
**Важно:** переводчик Google работает в ознакомительном режиме (без токена).
Это значит, что формат ответа может измениться и перестать восприниматься программой.
Либо может начать действовать ограничение на количество запросов.

## Особенности реализации

### Кэширование

В системе предусмотрено два уровня кэширования для перевода слов.
В начале проверяется LRU-кэш в памяти на 1000 элементов.
Если в нём искомого слова нет, ищется нужная запись в базе данных.
И только если перевода нет и в БД, идёт запрос к движку перевода (Яндекс или Google).
После чего ответ сохраняется в памяти и в БД.

### Многопоточность

Перевод предложения идёт пословно. Каждое слово переводится в отдельном потоке, всего не больше 10 потоков.
Если при переводе какого-то слова произошла ошибка (например, отсутствие сети), запланированные задачи на перевод остальных (еще не переведенных) слов отменяются.

## Дальнейшее развитие проекта

- Дописать тесты на все компоненты системы
- Перенести БД и сервис в Docker
- Улучшить систему логирования
- ...
